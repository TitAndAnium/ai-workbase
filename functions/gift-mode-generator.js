/**
 * Gift Mode Description Generator
 * Formats a rich Etsy-ready markdown block from structured input.
 * Includes fallback defaults and basic validation.
 * 
 * Author: Tayfun van Zantvoort
 */

function generateGiftModeDescription(data) {
  if (typeof data !== 'object' || data === null) {
    return '❌ Invalid input: expected an object.';
  }

  // Validate and fallback core fields
  const productType = data.productType || 'product';
  const recipient = data.recipient || 'someone special';
  const occasion = data.occasion || 'gift';
  const tone = data.tone || 'neutral';
  const style = data.style || 'modern';

  const features = Array.isArray(data.features)
    ? data.features.map(f => f.trim()).filter(f => f.length > 0)
    : [];

  const callouts = Array.isArray(data.callouts)
    ? data.callouts.map(c => c.trim()).filter(c => c.length > 0)
    : [];

  // Guard: at least 2 features needed
  if (features.length < 2) {
    return '❌ Not enough feature information to generate description.';
  }

  // Assemble markdown
  const lines = [];

  lines.push('::: Overview :::');
  lines.push(
    `Looking for the perfect ${occasion} for a ${recipient}? This ${productType} is designed with a ${style} style and a ${tone} tone — making it a thoughtful and practical choice.`
  );
  lines.push('');
  lines.push('::: Features :::');
  features.forEach((f) => lines.push(`- ${f}`));

  if (callouts.length > 0) {
    lines.push('');
    lines.push('::: Bonus Details :::');
    callouts.forEach((c) => lines.push(`- ${c}`));
  }

  lines.push('');
  lines.push('_Generated by gift-mode-generator.js_');

  return lines.join('\n');
}

// Export
module.exports = { generateGiftModeDescription };
